labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
all_path_ccf %>%  filter(start_week>as.Date("2020-11-01")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric==mob_met)
### RSV only
ggplot(all_path_ccf %>%  filter(start_week>as.Date("2020-11-01")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
### RSV only
ggplot(all_path_ccf %>%  filter(start_week>as.Date("2020-11-01")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>as.Date("2020-11-01")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_rt = ggplot()+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_hline(yintercept=1,lty="dashed",color="#004488",lwd=1)+
geom_line(data=rt_weekly %>%
filter(organism =="RSV B")%>%
filter(epi_date>as.Date("2021-01-16") & epi_date<as.Date("2022-03-07"))%>%
dplyr::select(epi_date,median,organism) %>%
distinct() %>% droplevels() ,
aes(x=epi_date,y=median,color=organism),lwd=1.2,lty="solid")+
geom_ribbon(data=rt_weekly %>%
filter(organism == "RSV B")%>%
filter(epi_date>as.Date("2021-01-16")& epi_date<as.Date("2022-03-07"))%>%
filter(organism %in% keep2)%>%
dplyr::select(epi_date,level,organism,lower,upper) %>%
filter(level==90)%>%
distinct() %>% droplevels(),
aes(x=epi_date,ymin=lower,ymax=upper,fill=organism),alpha=0.9)+
theme_bw(base_size = 12)+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
theme(legend.position = "none",strip.background = element_blank(),strip.text = element_text(size=12))+
# scale_color_jcolors(palette = "pal8")+
# scale_fill_jcolors(palette = "pal8")+
scale_color_manual(values=color_vec3)+
scale_fill_manual(values=color_vec3)+
# geom_vline(xintercept=as.Date("2019-02-03"),color="black",lty="dashed")+#snowstorm
# geom_vline(xintercept=as.Date("2019-02-11"),color="black",lty="dashed")+
# geom_vline(xintercept=as.Date("2020-02-29"),color="black",lty="dashed")+#state of emergency
# geom_vline(xintercept=as.Date("2020-03-11"),color="black",lty="dashed")+#King county SAH
# geom_vline(xintercept=as.Date("2020-06-03"),color="black",lty="dashed")+#statewide SAH lifted+
facet_wrap(~organism,nrow=1)+
ylab("Rt")+
xlab("Epidemic Week")
env_rt
rsv_rt
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,9,1.1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels="AUTO")
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
rt_mob_rsv
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 5,base_height = 12)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,2,1.1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,2,0.2),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.1,4,0.2),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.05,6,0.2),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.1,6,0.5),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.1,5,0.5),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.1,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rsv_rt = ggplot()+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_hline(yintercept=1,lty="dashed",color="#004488",lwd=1)+
geom_line(data=rt_weekly %>%
filter(organism =="RSV B")%>%
filter(epi_date>as.Date("2021-01-16") & epi_date<as.Date("2022-03-07"))%>%
dplyr::select(epi_date,median,organism) %>%
distinct() %>% droplevels() ,
aes(x=epi_date,y=median,color=organism),lwd=1.2,lty="solid")+
geom_ribbon(data=rt_weekly %>%
filter(organism == "RSV B")%>%
filter(epi_date>as.Date("2021-01-16")& epi_date<as.Date("2022-03-07"))%>%
filter(organism %in% keep2)%>%
dplyr::select(epi_date,level,organism,lower,upper) %>%
filter(level==90)%>%
distinct() %>% droplevels(),
aes(x=epi_date,ymin=lower,ymax=upper,fill=organism),alpha=0.9)+
theme_bw(base_size = 12)+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
theme(legend.position = "none",strip.background = element_blank(),strip.text.y = element_text(size=12),
strip.text.x = element_blank())+
# scale_color_jcolors(palette = "pal8")+
# scale_fill_jcolors(palette = "pal8")+
scale_color_manual(values=color_vec3)+
scale_fill_manual(values=color_vec3)+
# geom_vline(xintercept=as.Date("2019-02-03"),color="black",lty="dashed")+#snowstorm
# geom_vline(xintercept=as.Date("2019-02-11"),color="black",lty="dashed")+
# geom_vline(xintercept=as.Date("2020-02-29"),color="black",lty="dashed")+#state of emergency
# geom_vline(xintercept=as.Date("2020-03-11"),color="black",lty="dashed")+#King county SAH
# geom_vline(xintercept=as.Date("2020-06-03"),color="black",lty="dashed")+#statewide SAH lifted+
facet_wrap(~organism,nrow=1)+
ylab("Rt")+
xlab("Epidemic Week")
rsv_rt
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.15,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
all_path_ccf %>%  filter(start_week>as.Date("2020-11-01")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met)
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>=as.Date("2021-03-07")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_rt = ggplot()+
geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_hline(yintercept=1,lty="dashed",color="#004488",lwd=1)+
geom_line(data=rt_weekly %>%
filter(organism =="RSV B")%>%
filter(epi_date>=as.Date("2021-03-07") & epi_date<as.Date("2022-03-07"))%>%
dplyr::select(epi_date,median,organism) %>%
distinct() %>% droplevels() ,
aes(x=epi_date,y=median,color=organism),lwd=1.2,lty="solid")+
geom_ribbon(data=rt_weekly %>%
filter(organism == "RSV B")%>%
filter(epi_date>=as.Date("2021-03-07")& epi_date<as.Date("2022-03-07"))%>%
filter(organism %in% keep2)%>%
dplyr::select(epi_date,level,organism,lower,upper) %>%
filter(level==90)%>%
distinct() %>% droplevels(),
aes(x=epi_date,ymin=lower,ymax=upper,fill=organism),alpha=0.9)+
theme_bw(base_size = 12)+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
theme(legend.position = "none",strip.background = element_blank(),strip.text.y = element_text(size=12),
strip.text.x = element_blank())+
# scale_color_jcolors(palette = "pal8")+
# scale_fill_jcolors(palette = "pal8")+
scale_color_manual(values=color_vec3)+
scale_fill_manual(values=color_vec3)+
# geom_vline(xintercept=as.Date("2019-02-03"),color="black",lty="dashed")+#snowstorm
# geom_vline(xintercept=as.Date("2019-02-11"),color="black",lty="dashed")+
# geom_vline(xintercept=as.Date("2020-02-29"),color="black",lty="dashed")+#state of emergency
# geom_vline(xintercept=as.Date("2020-03-11"),color="black",lty="dashed")+#King county SAH
# geom_vline(xintercept=as.Date("2020-06-03"),color="black",lty="dashed")+#statewide SAH lifted+
facet_wrap(~organism,nrow=1)+
ylab("Rt")+
xlab("Epidemic Week")
rsv_rt
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.15,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
rsv_rt = ggplot()+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_hline(yintercept=1,lty="dashed",color="#004488",lwd=1)+
geom_line(data=rt_weekly %>%
filter(organism =="RSV B")%>%
filter(epi_date>=as.Date("2021-03-07") & epi_date<as.Date("2022-03-07"))%>%
dplyr::select(epi_date,median,organism) %>%
distinct() %>% droplevels() ,
aes(x=epi_date,y=median,color=organism),lwd=1.2,lty="solid")+
geom_ribbon(data=rt_weekly %>%
filter(organism == "RSV B")%>%
filter(epi_date>=as.Date("2021-03-07")& epi_date<as.Date("2022-03-07"))%>%
filter(organism %in% keep2)%>%
dplyr::select(epi_date,level,organism,lower,upper) %>%
filter(level==90)%>%
distinct() %>% droplevels(),
aes(x=epi_date,ymin=lower,ymax=upper,fill=organism),alpha=0.9)+
theme_bw(base_size = 12)+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
theme(legend.position = "none",strip.background = element_blank(),strip.text.y = element_text(size=12),
strip.text.x = element_blank())+
# scale_color_jcolors(palette = "pal8")+
# scale_fill_jcolors(palette = "pal8")+
scale_color_manual(values=color_vec3)+
scale_fill_manual(values=color_vec3)+
# geom_vline(xintercept=as.Date("2019-02-03"),color="black",lty="dashed")+#snowstorm
# geom_vline(xintercept=as.Date("2019-02-11"),color="black",lty="dashed")+
# geom_vline(xintercept=as.Date("2020-02-29"),color="black",lty="dashed")+#state of emergency
# geom_vline(xintercept=as.Date("2020-03-11"),color="black",lty="dashed")+#King county SAH
# geom_vline(xintercept=as.Date("2020-06-03"),color="black",lty="dashed")+#statewide SAH lifted+
facet_wrap(~organism,nrow=1)+
ylab("Rt")+
xlab("Epidemic Week")
rsv_rt
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>=as.Date("2021-03-07")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_rt = ggplot()+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_hline(yintercept=1,lty="dashed",color="#004488",lwd=1)+
geom_line(data=rt_weekly %>%
filter(organism =="RSV B")%>%
filter(epi_date>=as.Date("2021-03-07") & epi_date<as.Date("2022-03-07"))%>%
dplyr::select(epi_date,median,organism) %>%
distinct() %>% droplevels() ,
aes(x=epi_date,y=median,color=organism),lwd=1.2,lty="solid")+
geom_ribbon(data=rt_weekly %>%
filter(organism == "RSV B")%>%
filter(epi_date>=as.Date("2021-03-07")& epi_date<as.Date("2022-03-07"))%>%
filter(organism %in% keep2)%>%
dplyr::select(epi_date,level,organism,lower,upper) %>%
filter(level==90)%>%
distinct() %>% droplevels(),
aes(x=epi_date,ymin=lower,ymax=upper,fill=organism),alpha=0.9)+
theme_bw(base_size = 12)+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
theme(legend.position = "none",strip.background = element_blank(),strip.text.y = element_text(size=12),
strip.text.x = element_blank())+
# scale_color_jcolors(palette = "pal8")+
# scale_fill_jcolors(palette = "pal8")+
scale_color_manual(values=color_vec3)+
scale_fill_manual(values=color_vec3)+
# geom_vline(xintercept=as.Date("2019-02-03"),color="black",lty="dashed")+#snowstorm
# geom_vline(xintercept=as.Date("2019-02-11"),color="black",lty="dashed")+
# geom_vline(xintercept=as.Date("2020-02-29"),color="black",lty="dashed")+#state of emergency
# geom_vline(xintercept=as.Date("2020-03-11"),color="black",lty="dashed")+#King county SAH
# geom_vline(xintercept=as.Date("2020-06-03"),color="black",lty="dashed")+#statewide SAH lifted+
facet_wrap(~organism,nrow=1)+
ylab("Rt")+
xlab("Epidemic Week")
rsv_rt
rt_top = plot_grid(NULL,rsv_rt,NULL,rel_widths = c(0.2,4,1),nrow=1)
rt_mob_rsv = plot_grid(rt_top,rsv_mob_plot,nrow=2,rel_heights = c(1.5,8),labels=NULL)
save_plot(rt_mob_rsv ,file="~/OneDrive - National Institutes of Health/NIH_Laptop_Updates_Post_Damage/Documents/Seattle_Flu_Study/Epidemia_Models/figures/block_bootstrap_rsv_b_rebound_5mo_moving_window_and_rt.png",base_width = 12,base_height = 12)
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>=as.Date("2021-03-07")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2022-01-01"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_rt = ggplot()+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_hline(yintercept=1,lty="dashed",color="#004488",lwd=1)+
geom_line(data=rt_weekly %>%
filter(organism =="RSV B")%>%
filter(epi_date>=as.Date("2021-03-07") & epi_date<as.Date("2022-03-07"))%>%
dplyr::select(epi_date,median,organism) %>%
distinct() %>% droplevels() ,
aes(x=epi_date,y=median,color=organism),lwd=1.2,lty="solid")+
geom_ribbon(data=rt_weekly %>%
filter(organism == "RSV B")%>%
filter(epi_date>=as.Date("2021-03-07")& epi_date<as.Date("2022-03-07"))%>%
filter(organism %in% keep2)%>%
dplyr::select(epi_date,level,organism,lower,upper) %>%
filter(level==90)%>%
distinct() %>% droplevels(),
aes(x=epi_date,ymin=lower,ymax=upper,fill=organism),alpha=0.9)+
theme_bw(base_size = 12)+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
theme(legend.position = "none",strip.background = element_blank(),strip.text.y = element_text(size=12),
strip.text.x = element_blank())+
# scale_color_jcolors(palette = "pal8")+
# scale_fill_jcolors(palette = "pal8")+
scale_color_manual(values=color_vec3)+
scale_fill_manual(values=color_vec3)+
# geom_vline(xintercept=as.Date("2019-02-03"),color="black",lty="dashed")+#snowstorm
# geom_vline(xintercept=as.Date("2019-02-11"),color="black",lty="dashed")+
# geom_vline(xintercept=as.Date("2020-02-29"),color="black",lty="dashed")+#state of emergency
# geom_vline(xintercept=as.Date("2020-03-11"),color="black",lty="dashed")+#King county SAH
# geom_vline(xintercept=as.Date("2020-06-03"),color="black",lty="dashed")+#statewide SAH lifted+
facet_wrap(~organism,nrow=1)+
ylab("Rt")+
xlab("Epidemic Week")
rsv_mob_plot
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>=as.Date("2021-03-07")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-12-01"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_mob_plot
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>=as.Date("2021-03-07")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-10-01"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_vline(xintercept = as.Date("2021-12-01"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_mob_plot
### RSV only
rsv_mob_plot = ggplot(all_path_ccf %>%  filter(start_week>=as.Date("2021-03-07")&
start_week<as.Date("2022-06-01") &
pathogen =="RSV B" &
mobility_metric %in% mob_met),
aes(x=start_week,group=sig, y=as.numeric(obs_max_ccf),label=obs_max_ccf_lag))+
scale_x_date(date_breaks = "4 months",date_labels = "%b %y",expand=c(0.02,0.02))+
geom_vline(xintercept = as.Date("2021-11-01"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_vline(xintercept = as.Date("2021-12-01"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2021-05-14"),lty="dashed",color="darkgreen",lwd=0.7)+
# geom_vline(xintercept = as.Date("2022-03-11"),lty="dashed",color="darkgreen",lwd=0.7)+
geom_point(pch=21,size=5,aes(fill=as.numeric(obs_max_ccf_lag),alpha=sig))+
geom_text(aes(alpha=sig),hjust=0.5,vjust=0.5,size=3,color="white")+
facet_grid(mobility_metric~pathogen)+
geom_hline(aes(yintercept=0),lty="dashed")+
scale_alpha_manual(values = c(0.2,0.9),name="p(perm)<0.05")+
theme_bw(base_size = 18)+
ylab("Cross-Correlation Coefficient")+
scale_fill_viridis_c()+
xlab("5-Month Window Mid-Point")+
labs(fill="Optimal Lag\n(Weeks)")+
# ggtitle("4-Month Rolling Cross-Correlations\nMobility Indicators and hMPV Rt")+
theme(plot.title = element_text(hjust = 0.5),
strip.text.x = element_blank(),
strip.background.x=element_blank(),
strip.background.y = element_rect(fill="white"),
legend.position = "bottom",
strip.text.y.right = element_text(angle = 0))
rsv_mob_plot
